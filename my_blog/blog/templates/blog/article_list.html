{% extends 'blog/base.html' %}

{% block content %}
    <!-- Форма поиска -->
    <div class="card">
        <form method="get" style="display: flex; gap: 10px;">
            <input type="text" name="q" placeholder="Поиск по названию или автору..." value="{{ request.GET.q }}">
            <button type="submit" class="btn btn-primary">Найти</button>
            <a href="{% url 'article_list' %}" class="btn btn-danger" style="line-height: 2;">Сброс</a>
        </form>
    </div>

    <!-- Заголовок, если мы в разделе "Мои статьи" -->
    {% if request.resolver_match.url_name == 'my_articles' %}
        <h2 style="margin-bottom: 20px;">Мои публикации</h2>
    {% endif %}

    <!-- Список статей -->
    {% for article in articles %}
        <div class="card">
            <h2>{{ article.title }} <span class="badge">{{ article.group.name }}</span></h2>
            <div class="meta">
                Автор: <strong>{{ article.author.username }}</strong> | 
                Дата: {{ article.pub_date|date:"d M Y H:i" }}
            </div>
            <p>{{ article.content|truncatewords:30 }}</p>
            
            <!-- КНОПКИ ВИДИТ ТОЛЬКО АВТОР -->
            {% if article.author == user %}
                <hr style="border: 0; border-top: 1px solid #eee;">
                <div style="text-align: right;">
                    <a href="{% url 'article_update' article.pk %}" class="btn btn-edit">Редактировать</a>
                    <a href="{% url 'article_delete' article.pk %}" class="btn btn-danger">Удалить</a>
                </div>
            {% endif %}
        </div>
    {% empty %}
        <div class="card">
            <p>Статей пока нет.</p>
        </div>
    {% endfor %}
{% endblock %}